<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RestoBook - –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–æ–ª–∏–∫–æ–≤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .widget {
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .card {
            transition: transform 0.2s;
            margin-bottom: 15px;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .navbar-brand {
            font-weight: bold;
            font-size: 1.5rem;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">üçΩ RestoBook</a>
            
            <!-- –ü–æ–∏—Å–∫ -->
            <form class="d-flex mx-3" method="GET" action="{% url 'search_restaurants' %}">
                <input class="form-control me-2" type="search" name="q" placeholder="–ü–æ–∏—Å–∫ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤..." aria-label="Search">
                <button class="btn btn-outline-light" type="submit">–ù–∞–π—Ç–∏</button>
            </form>

            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
            <div class="navbar-nav">
                <a class="nav-link" href="{% url 'all_restaurants' %}">–í—Å–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã</a>
                <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ - –¢–û–õ–¨–ö–û –î–õ–Ø STAFF -->
                {% if user.is_staff %}
                <a class="nav-link" href="{% url 'restaurant_create' %}">–î–æ–±–∞–≤–∏—Ç—å —Ä–µ—Å—Ç–æ—Ä–∞–Ω</a>
                {% endif %}
            </div>

            <!-- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
            <div class="navbar-nav ms-auto">
                {% if user.is_authenticated %}
                    <a class="nav-link" href="{% url 'user_reservations' %}">üìÖ –ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</a>
                    <span class="navbar-text me-3">–ü—Ä–∏–≤–µ—Ç, {{ user.username }}!</span>
                    <a class="nav-link" href="{% url 'logout' %}">–í—ã–π—Ç–∏</a>
                {% else %}
                    <a class="nav-link" href="{% url 'register' %}">üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                    <a class="nav-link" href="{% url 'login' %}">–í–æ–π—Ç–∏</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ -->
    {% if search_results %}
    <div class="container mt-4">
        <div class="alert alert-info">
            <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –¥–ª—è "{{ search_query }}"</h4>
            <p>–ù–∞–π–¥–µ–Ω–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤: {{ search_results.count }}</p>
        </div>
        
        <div class="row">
            {% for restaurant in search_results %}
            <div class="col-md-4 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">
                            <a href="{% url 'restaurant_detail' restaurant.id %}" class="text-decoration-none">{{ restaurant.name }}</a>
                        </h5>
                        <p class="card-text">
                            <strong>–ö—É—Ö–Ω—è:</strong> {{ restaurant.get_cuisine_type_display }}<br>
                            <strong>–ê–¥—Ä–µ—Å:</strong> {{ restaurant.address }}<br>
                            <strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ restaurant.phone }}
                        </p>
                        <a href="{% url 'restaurant_detail' restaurant.id %}" class="btn btn-primary">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <hr class="my-5">
    </div>
    {% endif %}

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center mb-4">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ RestoBook!</h1>
                <p class="text-center lead">–°–∏—Å—Ç–µ–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–æ–ª–∏–∫–æ–≤ –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞—Ö</p>
            </div>
        </div>

        <!-- –í–∏–¥–∂–µ—Ç 1: –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã -->
        <div class="widget">
            <h2>üéØ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–∏</h2>
            <div class="row">
                {% for restaurant in popular_restaurants %}
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">
                                <a href="{% url 'restaurant_detail' restaurant.id %}" class="text-decoration-none">{{ restaurant.name }}</a>
                            </h5>
                            <p class="card-text">
                                <small class="text-muted">{{ restaurant.get_cuisine_type_display }}</small><br>
                                –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π: {{ restaurant.reservation_count }}
                            </p>
                            <a href="{% url 'restaurant_detail' restaurant.id %}" class="btn btn-primary btn-sm">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="col-12">
                    <p class="text-muted">–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞—Ö</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- –í–∏–¥–∂–µ—Ç 2: –°–≤–æ–±–æ–¥–Ω—ã–µ —Å—Ç–æ–ª–∏–∫–∏ -->
        <div class="widget">
            <h2>üÜì –°–≤–æ–±–æ–¥–Ω—ã–µ —Å—Ç–æ–ª–∏–∫–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è ({{ today }})</h2>
            <div class="row">
                {% for table in available_tables %}
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">–°—Ç–æ–ª–∏–∫ {{ table.table_number }}</h5>
                            <p class="card-text">
                                –†–µ—Å—Ç–æ—Ä–∞–Ω: {{ table.restaurant.name }}<br>
                                –í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: {{ table.capacity }} —á–µ–ª.<br>
                                –¶–µ–Ω–∞: {{ table.price_per_hour }} —Ä—É–±./—á–∞—Å
                            </p>
                            <!-- –ö–Ω–æ–ø–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
                            {% if user.is_authenticated %}
                                <a href="{% url 'make_reservation' table.id %}" class="btn btn-success">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</a>
                            {% else %}
                                <a href="{% url 'login' %}?next={{ request.path }}" class="btn btn-outline-success">–í–æ–π—Ç–∏ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="col-12">
                    <p class="text-muted">–ù–∞ —Å–µ–≥–æ–¥–Ω—è –≤—Å–µ —Å—Ç–æ–ª–∏–∫–∏ –∑–∞–Ω—è—Ç—ã</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- –í–∏–¥–∂–µ—Ç 3: –†–µ—Å—Ç–æ—Ä–∞–Ω—ã —Å –ª—É—á—à–∏–º–∏ —Ü–µ–Ω–∞–º–∏ -->
        <div class="widget">
            <h2>üí∞ –†–µ—Å—Ç–æ—Ä–∞–Ω—ã —Å –ª—É—á—à–∏–º–∏ —Ü–µ–Ω–∞–º–∏</h2>
            <div class="row">
                {% for restaurant in affordable_restaurants %}
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">
                                <a href="{% url 'restaurant_detail' restaurant.id %}" class="text-decoration-none">{{ restaurant.name }}</a>
                            </h5>
                            <p class="card-text">
                                <strong>–ö—É—Ö–Ω—è:</strong> {{ restaurant.get_cuisine_type_display }}<br>
                                <strong>–û—Ç:</strong> {{ restaurant.min_price }} —Ä—É–±./—á–∞—Å<br>
                                <strong>–ê–¥—Ä–µ—Å:</strong> {{ restaurant.address }}
                            </p>
                            <a href="{% url 'restaurant_detail' restaurant.id %}" class="btn btn-warning btn-sm">–í—ã–±—Ä–∞—Ç—å —Å—Ç–æ–ª–∏–∫</a>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="col-12">
                    <p class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞—Ö</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- –í–∏–¥–∂–µ—Ç 4: –†–µ—Å—Ç–æ—Ä–∞–Ω—ã —Å –±–æ–ª—å—à–∏–º–∏ —Å—Ç–æ–ª–∏–∫–∞–º–∏ -->
        <div class="widget">
            <h2>üë• –†–µ—Å—Ç–æ—Ä–∞–Ω—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö –∫–æ–º–ø–∞–Ω–∏–π</h2>
            <div class="row">
                {% for restaurant in large_tables_restaurants %}
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">
                                <a href="{% url 'restaurant_detail' restaurant.id %}" class="text-decoration-none">{{ restaurant.name }}</a>
                            </h5>
                            <p class="card-text">
                                <strong>–ö—É—Ö–Ω—è:</strong> {{ restaurant.get_cuisine_type_display }}<br>
                                <strong>–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:</strong> –¥–æ {{ restaurant.max_capacity }} —á–µ–ª.<br>
                                <strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ restaurant.phone }}
                            </p>
                            <a href="{% url 'restaurant_detail' restaurant.id %}" class="btn btn-info btn-sm">–î–ª—è –∫–æ–º–ø–∞–Ω–∏–∏</a>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="col-12">
                    <p class="text-muted">–ù–µ—Ç —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ —Å –±–æ–ª—å—à–∏–º–∏ —Å—Ç–æ–ª–∏–∫–∞–º–∏</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="widget">
            <h2>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ RestoBook</h2>
            <div class="row text-center">
                <div class="col-md-3">
                    <div class="card bg-primary text-white">
                        <div class="card-body">
                            <h3>{{ stats.total_restaurants }}</h3>
                            <p>–í—Å–µ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-success text-white">
                        <div class="card-body">
                            <h3>{{ stats.avg_table_price|floatformat:0 }}</h3>
                            <p>–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ (—Ä—É–±/—á–∞—Å)</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-info text-white">
                        <div class="card-body">
                            <h3>{{ stats.max_capacity }}</h3>
                            <p>–ú–∞–∫—Å. –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-warning text-white">
                        <div class="card-body">
                            <h3>{{ stats.min_price }}</h3>
                            <p>–ú–∏–Ω. —Ü–µ–Ω–∞ (—Ä—É–±/—á–∞—Å)</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>